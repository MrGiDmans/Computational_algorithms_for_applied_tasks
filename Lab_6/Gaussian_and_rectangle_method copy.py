import numpy as np
import math

# ------------------------------
# 1. Исходные данные
# ------------------------------
a = 0
b = 2

# Подынтегральная функция E0(x)
def E0(x):
    return (x**2 - 1) * math.exp(-2 * x)

# ------------------------------
# 2. Метод прямоугольников (средних)
# ------------------------------
def rectangle_method(func, a, b, n):
    h = (b - a) / n
    s = 0
    for j in range(1, n + 1):
        xj = a + (j - 0.5) * h   # середина отрезка
        s += func(xj)
    return h * s


# ------------------------------
# 3. Метод Гаусса (5 и 7 узлов)
# ------------------------------

# Таблица узлов и весов для квадратур Гаусса-Лежандра на интервале [-1, 1]
# (взято из стандартных таблиц)

GAUSS_TABLE = {
    5: {
        "t": np.array([-0.9061798459, -0.5384693101, 0.0, 0.5384693101, 0.9061798459]),
        "A": np.array([0.2369268850, 0.4786286705, 0.5688888889, 0.4786286705, 0.2369268850])
    },
    7: {
        "t": np.array([-0.9491079123, -0.7415311856, -0.4058451514, 0.0, 0.4058451514, 0.7415311856, 0.9491079123]),
        "A": np.array([0.1294849662, 0.2797053915, 0.3818300505, 0.4179591837, 0.3818300505, 0.2797053915, 0.1294849662])
    }
}

def gauss_method(func, a, b, m):
    t = GAUSS_TABLE[m]["t"]
    A = GAUSS_TABLE[m]["A"]

    # Преобразование переменной x = (b + a)/2 + (b - a)/2 * t
    xm = 0.5 * (b + a)
    xr = 0.5 * (b - a)

    # Вычисление суммы по формуле Гаусса
    s = 0
    for i in range(m):
        s += A[i] * func(xm + xr * t[i])
    return xr * s


# ------------------------------
# 4. Основной блок программы
# ------------------------------

if __name__ == "__main__":
    # Разные значения n для метода прямоугольников
    n_values = [10, 50, 100]

    print("Метод прямоугольников (средних точек):")
    for n in n_values:
        I_rect = rectangle_method(E0, a, b, n)
        print(f"  n = {n:3d} -> I ≈ {I_rect:.8f}")

    print("\nМетод Гаусса:")
    for m in [5, 7]:
        I_gauss = gauss_method(E0, a, b, m)
        print(f"  m = {m} -> I ≈ {I_gauss:.8f}")

    # Для проверки можно сравнить с точным интегралом (аналитически)
    # I = ∫ (x² - 1)e^{-2x} dx = ...
    # Символьное выражение для проверки:
    from sympy import symbols, integrate, exp
    x = symbols('x')
    exact_expr = integrate((x**2 - 1) * exp(-2*x), (x, a, b))
    exact_value = float(exact_expr)
    print("\nТочное значение (SymPy):", f"{exact_value:.8f}")
